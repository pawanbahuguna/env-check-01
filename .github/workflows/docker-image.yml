name: Docker Image CI

on:
  workflow_dispatch:
    inputs:
      image:
        description: Which Image to build (Example - java, python)
        required: true
      tag:
        description: Enter the Tag, default is 7
        type: string
        default: '7'
        required: false

jobs:

  build:

    runs-on: ubuntu-latest
    #environment: production

    steps:
    - uses: actions/checkout@v3
    - name: Build the Docker image
      run: |
        echo ---- Building Docker Image ----
        cd $DOCKER_IMAGE
        docker build . --file Dockerfile --tag pb/$DOCKER_IMAGE:$TAGS
        docker images
        docker save pb/$DOCKER_IMAGE:$TAGS | gzip > $DOCKER_IMAGE.tar.gz
        ls
        md5sum $DOCKER_IMAGE.tar.gz
    - name: 'Upload Artifact'
      uses: actions/upload-artifact@v3
      with:
        name: my-artifact
        path: $DOCKER_IMAGE.tar.gz
        retention-days: 5
      env:
        DOCKER_IMAGE: ${{ github.event.inputs.image }}
        TAGS: ${{ github.event.inputs.tags }}
      
   
  deploy:
    needs: build
    runs-on: ubuntu-latest
    environment: production
    steps:
    - name: Download a Docker Image Tar
      uses: actions/download-artifact@v3
      with:
       name: my-artifact   
    - name: Deploy to S3
      run: |
        ls
        echo ---- Send tar to S3 ----
    
